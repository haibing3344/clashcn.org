import{_ as t,c as e,o as r,ag as i}from"./chunks/framework.DPDPlp3K.js";const g=JSON.parse('{"title":"TProxy TCP/UDP","description":"TProxy（Transparent Proxy，透明代理）是Linux内核中的一个模块，用于透明地代理TCP和UDP流量。透明代理的主要特点是，客户端并不知道其流量正在通过代理服务器，这使得它在某些应用场景中非常有用，如负载均衡、安全监控和网络优化。","frontmatter":{"title":"TProxy TCP/UDP","description":"TProxy（Transparent Proxy，透明代理）是Linux内核中的一个模块，用于透明地代理TCP和UDP流量。透明代理的主要特点是，客户端并不知道其流量正在通过代理服务器，这使得它在某些应用场景中非常有用，如负载均衡、安全监控和网络优化。","head":[["link",{"rel":"canonical","href":"https://www.clashcn.org/wiki/TProxy.html"}],["meta",{"property":"og:local","content":"en-US"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:title","content":"TProxy TCP/UDP | Clash for Windows"}],["meta",{"property":"og:description","content":"TProxy（Transparent Proxy，透明代理）是Linux内核中的一个模块，用于透明地代理TCP和UDP流量。透明代理的主要特点是，客户端并不知道其流量正在通过代理服务器，这使得它在某些应用场景中非常有用，如负载均衡、安全监控和网络优化。"}],["meta",{"property":"og:url","content":"https://www.clashcn.org/wiki/TProxy.html"}],["meta",{"property":"og:site_name","content":"Clash for Windows"}],["meta",{"property":"og:image","content":"https://www.clashcn.org/android-chrome-192x192.png"}],["meta",{"property":"og:image:width","content":"192"}],["meta",{"property":"og:image:height","content":"192"}],["meta",{"property":"og:image:type","content":"image/png"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"author","content":"Clash for Windows"}],["meta",{"name":"twitter:label1","content":"作者"}],["meta",{"name":"twitter:data1","content":"Clash for Windows"}]]},"headers":[],"relativePath":"wiki/TProxy.md","filePath":"wiki/TProxy.md"}'),s={name:"wiki/TProxy.md"};function n(o,a,l,p,c,h){return r(),e("div",null,a[0]||(a[0]=[i(`<h1 id="tproxy-tcp-udp" tabindex="-1">TProxy TCP/UDP <a class="header-anchor" href="#tproxy-tcp-udp" aria-label="Permalink to &quot;TProxy TCP/UDP&quot;">​</a></h1><p>TProxy（Transparent Proxy，透明代理）是Linux内核中的一个模块，用于透明地代理<a href="/wiki/TCP.html">TCP</a>和<a href="/wiki/UDP.html">UDP</a>流量。透明代理的主要特点是，客户端并不知道其流量正在通过代理服务器，这使得它在某些应用场景中非常有用，如负载均衡、安全监控和网络优化。以下是对TProxy的详细介绍：</p><h2 id="tproxy-的特点" tabindex="-1">TProxy 的特点 <a class="header-anchor" href="#tproxy-的特点" aria-label="Permalink to &quot;TProxy 的特点&quot;">​</a></h2><ul><li><strong>透明性</strong>：客户端无需进行任何配置或意识到代理的存在，代理服务器可以截获并处理流量。</li><li><strong>TCP/UDP支持</strong>：TProxy同时支持<a href="/wiki/TCP.html">TCP</a>和<a href="/wiki/UDP.html">UDP</a>流量，可以代理各种类型的网络通信。</li><li><strong>灵活性</strong>：与iptables结合使用，可以灵活地定义流量重定向和处理规则。</li><li><strong>无中断</strong>：由于TProxy在网络层工作，流量的代理过程对客户端是无缝的，不会中断通信。</li></ul><h2 id="工作原理" tabindex="-1">工作原理 <a class="header-anchor" href="#工作原理" aria-label="Permalink to &quot;工作原理&quot;">​</a></h2><p>TProxy工作在Linux内核的网络层，通过修改IP包的目的地址，将流量透明地重定向到代理服务器进行处理。具体步骤如下：</p><ul><li><strong>捕获流量</strong>：使用iptables将流量捕获并重定向到TProxy模块。</li><li><strong>代理处理</strong>：TProxy接收到重定向的流量，对其进行处理后转发到目标服务器。</li><li><strong>返回响应</strong>：目标服务器的响应流量通过TProxy返回给客户端，客户端认为其直接与目标服务器通信。</li></ul><h2 id="配置步骤" tabindex="-1">配置步骤 <a class="header-anchor" href="#配置步骤" aria-label="Permalink to &quot;配置步骤&quot;">​</a></h2><p>以下是配置TProxy以透明代理TCP和UDP流量的示例步骤：</p><h3 id="前提条件" tabindex="-1">前提条件 <a class="header-anchor" href="#前提条件" aria-label="Permalink to &quot;前提条件&quot;">​</a></h3><ul><li>安装并配置好Linux操作系统。</li><li>确保内核版本支持TProxy（Linux内核2.6.28及以上）。</li><li>安装iptables和iproute2工具。</li></ul><h3 id="内核模块加载" tabindex="-1">内核模块加载 <a class="header-anchor" href="#内核模块加载" aria-label="Permalink to &quot;内核模块加载&quot;">​</a></h3><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>modprobe xt_TPROXY</span></span>
<span class="line"><span>modprobe nf_tproxy_core</span></span></code></pre></div><h3 id="配置iptables" tabindex="-1">配置iptables <a class="header-anchor" href="#配置iptables" aria-label="Permalink to &quot;配置iptables&quot;">​</a></h3><ul><li><p><strong>创建mangle表规则</strong>： 捕获并重定向流量到本地的代理端口。</p><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>iptables -t mangle -N DIVERT</span></span>
<span class="line"><span>iptables -t mangle -A PREROUTING -p tcp -m socket -j DIVERT</span></span>
<span class="line"><span>iptables -t mangle -A PREROUTING -p udp -m socket -j DIVERT</span></span>
<span class="line"><span>iptables -t mangle -A DIVERT -j MARK --set-mark 1</span></span>
<span class="line"><span>iptables -t mangle -A DIVERT -j ACCEPT</span></span></code></pre></div></li><li><p><strong>添加PREROUTING规则</strong>： 将流量重定向到TProxy。</p><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>iptables -t mangle -A PREROUTING -p tcp -j TPROXY --tproxy-mark 0x1/0x1 --on-port 12345</span></span>
<span class="line"><span>iptables -t mangle -A PREROUTING -p udp -j TPROXY --tproxy-mark 0x1/0x1 --on-port 12345</span></span></code></pre></div></li></ul><h3 id="配置ip-rule和ip-route" tabindex="-1">配置ip rule和ip route <a class="header-anchor" href="#配置ip-rule和ip-route" aria-label="Permalink to &quot;配置ip rule和ip route&quot;">​</a></h3><ul><li><p><strong>设置ip rule</strong>： 为标记流量设置路由规则。</p><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip rule add fwmark 1 lookup 100</span></span></code></pre></div></li><li><p><strong>设置路由表</strong>： 配置路由表100，将流量重定向到本地。</p><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ip route add local 0.0.0.0/0 dev lo table 100</span></span></code></pre></div></li></ul><h2 id="示例-使用tproxy代理http流量" tabindex="-1">示例：使用TProxy代理HTTP流量 <a class="header-anchor" href="#示例-使用tproxy代理http流量" aria-label="Permalink to &quot;示例：使用TProxy代理HTTP流量&quot;">​</a></h2><p>假设你有一个运行在本地12345端口的HTTP代理服务器，可以使用以下配置来透明代理HTTP流量：</p><h3 id="配置iptables-1" tabindex="-1">配置iptables <a class="header-anchor" href="#配置iptables-1" aria-label="Permalink to &quot;配置iptables&quot;">​</a></h3><p>bash</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>iptables -t mangle -A PREROUTING -p tcp --dport 80 -j TPROXY --tproxy-mark 0x1/0x1 --on-port 12345</span></span>
<span class="line"><span>iptables -t mangle -A PREROUTING -p tcp --dport 443 -j TPROXY --tproxy-mark 0x1/0x1 --on-port 12345</span></span></code></pre></div><h2 id="应用场景" tabindex="-1">应用场景 <a class="header-anchor" href="#应用场景" aria-label="Permalink to &quot;应用场景&quot;">​</a></h2><ul><li><strong>负载均衡</strong>：TProxy可以将流量透明地分发到多个服务器，实现负载均衡。</li><li><strong>安全监控</strong>：透明代理可以监控和过滤网络流量，检测和阻止恶意行为。</li><li><strong>网络优化</strong>：通过代理服务器缓存和优化流量，提升网络性能。</li><li><strong>访问控制</strong>：基于流量特征进行访问控制和权限管理。</li></ul><h2 id="优缺点" tabindex="-1">优缺点 <a class="header-anchor" href="#优缺点" aria-label="Permalink to &quot;优缺点&quot;">​</a></h2><p><strong>优点</strong>：</p><ul><li>对客户端透明，无需修改客户端配置。</li><li>支持TCP和UDP流量，适用范围广。</li><li>与iptables结合，规则配置灵活。</li></ul><p><strong>缺点</strong>：</p><ul><li>需要较高的网络配置和维护技巧。</li><li>增加了代理服务器的负载，对硬件要求较高。</li></ul><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>TProxy是一种强大的透明代理工具，适用于需要透明代理和处理网络流量的各种场景。通过与iptables和iproute2结合使用，TProxy可以灵活地捕获和重定向TCP和UDP流量，实现负载均衡、安全监控和网络优化等功能。尽管配置复杂，但其强大的功能和灵活性使其成为网络管理员和开发者的重要工具。</p><div class="tip custom-block"><p class="custom-block-title">🎉 节点推荐</p><ul><li>🚀 <a href="https://www.xn--9kqrm7t.com/#/register?code=JRtE5uIV" target="_blank" rel="noreferrer">优信云：IEPL/IPLC 高速专线，￥15.00/月</a><br></li><li><a href="https://cinb01.xxfaff.cc/#/register?inviteCode=80C209ADC772" target="_blank" rel="noreferrer">小旋风：IPLC专线高速稳定！8元/月起</a><br></li><li><a href="https://erwan6.net/auth/register?code=BoObCd" target="_blank" rel="noreferrer">尔湾云：最大峰值1000Mbps，全流媒体及ChatGPT解锁！最低12元/月</a><br></li><li><a href="https://ca01.dgy01.cc/#/register?code=JSSN0WQ9" target="_blank" rel="noreferrer">大哥云：年付低至7元/月，4年稳定老牌机场</a><br></li><li><a href="https://inv01.fatcatcloud.cc/register?aff=X1vZd2wf" target="_blank" rel="noreferrer">肥猫云：全专线中转隧道，高速大宽带不限设备数，低至6元/月（年付）</a><br></li><li><a href="https://homes.tr25.cn?code=ReCm" target="_blank" rel="noreferrer">疾风云：包年 6.9折 优惠码: jf2025</a></li></ul></div>`,33)]))}const u=t(s,[["render",n]]);export{g as __pageData,u as default};
